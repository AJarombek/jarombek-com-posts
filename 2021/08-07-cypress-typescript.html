<div>
<p>
Cypress is an end to end (e2e) testing framework written in JavaScript for front-end applications.  Cypress tests run
in a Chrome web browser or in a headless browser, navigating through and interacting with web pages.  While it’s
reasonable to compare Cypress to other test automation frameworks such as Selenium or Puppeteer, Cypress was created
specifically for writing end to end tests.  Because of its test first design, Cypress provides lots of features that
make writing end to end tests easy.  It is currently my preferred end to end testing tool.
</p>
<p>
While Cypress tests can be written in JavaScript, as is the case with my <a href="https://github.com/AJarombek/
jarombek-com/tree/master/cypress/integration">jarombek.com</a> application, it also has TypeScript support.  Nowadays,
I write most of my front-end applications in TypeScript due to its type safety.  In my experience, TypeScript helps
reduce the number of bugs and type mismatch mistakes in JavaScript code.  For applications written in TypeScript, it is
great to be able to write Cypress tests in TypeScript as well.  This helps keep the programming language usage uniform
across the front-end application code and test code.
</p>
<p>
In this article, I discuss the basics of Cypress and how I use it to test my front-end applications.  All the Cypress
test code I show is written in TypeScript.  The Cypress test code comes from two of my application repositories:
<a href="https://github.com/AJarombek/apollo-client-server-prototype/tree/master/client/cypress">apollo-client-server-prototype</a>
and <a href="https://github.com/AJarombek/saints-xctf-web/tree/master/cypress">saints-xctf-web</a>.
</p>
<SectionTitle title="What is End to End Testing">What is End to End Testing?</SectionTitle>
<Definition word="End to End Testing">
End to end (E2E) testing is the practice of writing tests for an application from one end to another, from beginning to
end.  In essence, these tests cover the entire execution flow of an application in a production-like environment.  In
the case of a front-end application, this means testing the application by interacting with the UI as an actual user
would. Because these tests are executed in a production-like environment, all the API calls used by the front-end code
are invoked as part of the tests.  This results in the application being executed from end to end - from the front-end
to the back-end and database.
</Definition>
<p>
With Cypress, end to end tests are run in a web browser.  Tests navigate to a web page and make assertions about the
content shown.  Then, they can interact with the page and make further assertions about what changed in the UI, check
what network calls were made, and more.
</p>
<SectionTitle title="Cypress Basics">Cypress Basics</SectionTitle>
<p>
Cypress is installed from its <a href="https://www.npmjs.com/package/cypress">cypress</a> npm package.  Cypress is
pretty easy to configure with an application.  For example, my <a href="https://saintsxctf.com">saintsxctf.com</a>
application uses Cypress and is configured to use it with TypeScript.  For starters, its repository
<a href="https://github.com/AJarombek/saints-xctf-web">saints-xctf-web</a> is written as an npm package, with
<code className="jarombek-inline-code">cypress</code> defined as a dev dependency in its <a href="https://github.com/
AJarombek/saints-xctf-web/blob/master/package.json#L77">package.json</a> file.  Next, a <a href="https://github.com/
AJarombek/saints-xctf-web/blob/master/cypress.json">cypress.json</a> file exists in the root directory of the npm
package.  This is the main configuration file for Cypress, with the contents of my configuration file shown below.
</p>
<CodeSnippet language="JSON">
{
  "baseUrl": "http://localhost:8090",
  "ignoreTestFiles": ["*.md"],
  "env": {
    ...
  }
}
</CodeSnippet>
<p>
Although the fields of the configuration file are optional, they do help simplify tests and configure the settings of
Cypress to fit your needs<sup>1</sup>.  In my configuration file, <code className="jarombek-inline-code">baseUrl</code>
configures the default base URL to use for all my tests, so that I don’t need to copy-paste it across all my test cases.
<code className="jarombek-inline-code">ignoreTestFiles</code> configures the Cypress test runner to ignore any Markdown
files in the test directory, in my case which are used for documentation purposes.  Finally,
<code className="jarombek-inline-code">env</code> sets environment variables which are accessible to the Cypress test
code.  Cypress has many additional <a href="https://docs.cypress.io/guides/references/configuration#Options">
configuration options</a> listed in their documentation.
</p>
<p>
The actual Cypress test code is written in a <a href="https://github.com/AJarombek/saints-xctf-web/tree/master/cypress">cypress</a>
directory located in the root of the npm package.  The <strong>cypress</strong> folder and its subdirectories are
created as a scaffold automatically when Cypress is first run in the project, so there is no need to create these
manually.  Inside <strong>cypress</strong> are four subdirectories - <strong>fixtures</strong>, <strong>integration</strong>,
<strong>plugins</strong>, and <strong>support</strong> - along with a <a href="https://github.com/AJarombek/
saints-xctf-web/blob/master/cypress/tsconfig.json">tsconfig.json</a> file to configure TypeScript.
</p>
<figure>
<img className="jarombek-blog-image" src="https://asset.jarombek.com/posts/8-7-21-cypress-directory.png"/>
</figure>
<p>
The <strong>integration</strong> directory holds the Cypress end to end tests.  In my case, these tests are TypeScript
files with <strong>.e2e.test.ts</strong> file extensions.  For example, the Cypress tests for the home page of my
<a href="https://saintsxctf.com">saintsxctf.com</a> website are located in a <a href="https://github.com/AJarombek/
saints-xctf-web/blob/master/cypress/integration/Home.e2e.test.ts">Home.e2e.test.ts</a> file.
</p>
<p>
The <strong>fixtures</strong> directory contains static assets used by the tests.  The majority of the files in my
<a href="https://github.com/AJarombek/saints-xctf-web/blob/master/cypress/fixtures">fixtures</a> directory are JSON
files representing mocked API responses.  In certain end to end tests, it’s preferable to use fixed API responses
instead of ones from an actual live API.  This is often due to the unpredictability of API data, and a need to test
specific repeatable scenarios.  It’s also due to the requirement of testing failure scenarios on the website, such as
when an API returns an unexpected error code.  These scenarios are easily achieved by mocking the API responses with
the JSON files found in the <strong>fixtures</strong> directory.  The other static assets found in my
<strong>fixtures</strong> directory are pictures, which are used for testing profile picture and group picture
uploading on my website.
</p>
<p>
The <strong>plugins</strong> directory contains a single <a href="https://github.com/AJarombek/saints-xctf-web/blob/
master/cypress/plugins/index.js">index.js</a> JavaScript file that runs in Node.js before the Cypress tests
begin<sup>2</sup>.  This file is used to configure first-party and third-party tooling which extends the functionality
of Cypress.  For example, my plugins file configures a <a href="https://docs.cypress.io/guides/tooling/
code-coverage#E2E-code-coverage">code coverage plugin</a> to generate code coverage reports for my end to end
tests<sup>3</sup>.  Code coverage reports require an additional <code className="jarombek-inline-code">@cypress/code-coverage</code>
dev dependency in my <a href="https://github.com/AJarombek/saints-xctf-web/blob/master/package.json#L51">package.json</a>
file.
</p>
<p>
The <strong>support</strong> directory contains custom commands used throughout the Cypress tests.  These custom
commands contain reusable code, making the Cypress tests more concise and <a href="https://jarombek.com/blog/
jun-17-2019-terraform-module#dry-principal">DRY</a>.  The <a href="https://github.com/AJarombek/saints-xctf-web/blob/
master/cypress/support/index.ts">index.ts</a> file is run automatically before every Cypress test file, so that the
custom commands don’t need to be imported repeatedly into all the test files<sup>4</sup>.  There is a whole section of
this article dedicated to writing custom commands in Cypress.
</p>
<p>
The <a href="https://github.com/AJarombek/saints-xctf-web/blob/master/cypress/tsconfig.json">tsconfig.json</a> file in
the <strong>cypress</strong> folder creates and configures a TypeScript project for the Cypress tests, separate from the
TypeScript project for the source code.  The most important property of the JSON configuration is
<code className="jarombek-inline-code">compilerOptions.types</code>, which specifies that only the type definitions
specific to Cypress should be used in the test code<sup>5</sup>.
</p>
<CodeSnippet language="JSON">
{
  "compilerOptions": {
    "strict": true,
    "baseUrl": "../node_modules",
    "target": "ES5",
    "lib": ["ES5", "DOM"],
    "types": ["cypress", "cypress-file-upload"]
  },
  "include": ["**/*.ts"]
}
</CodeSnippet>
<p>
There are two main ways to run Cypress tests: in a web browser or in a headless browser.  Inside my <a href="https://github.com/
AJarombek/saints-xctf-web/blob/master/package.json#L120-L122">package.json</a> file, I specify multiple custom commands
for running Cypress tests.  The first command, <code className="jarombek-inline-code">cypress open</code> (aliased as
<code className="jarombek-inline-code">cy:open</code>), opens the Cypress test runner and allows you to run test files
in a web browser.  The test runner is shown below.
</p>
<figure>
<img className="jarombek-blog-image" src="https://asset.jarombek.com/posts/8-7-21-cypress-test-runner.png"/>
</figure>
<p>
The test runner lists all the end to end test files, referred to as <strong>specs</strong>, which exist in the
<strong>integration</strong> directory.  Clicking on any of the file names will open a web browser and begin running
the tests.
</p>
<figure>
<img className="jarombek-blog-image" src="https://asset.jarombek.com/posts/8-7-21-cypress-browser.png"/>
</figure>
<p>
In the screenshot above, all three tests passed.  While the tests run, the Cypress commands which execute are displayed
on the left hand side of the browser.  On the right hand side, the current state of the website in the test is shown.
This is great for seeing your tests execute on the UI, and allows for easy debugging if tests are failing.
</p>
<figure>
<img className="jarombek-blog-image" src="https://asset.jarombek.com/posts/8-7-21-cypress-executed-test.png"/>
</figure>
<p>
The other way to run tests is with a headless browser.  Headless browsers provide an execution environment similar to a
web browser, except they are run from a command line<sup>6</sup>.  Executing Cypress tests in headless browsers is great
for CI/CD pipelines which run tests in an automated fashion.  The
<code className="jarombek-inline-code">cypress run --headless</code> command (aliased as
<code className="jarombek-inline-code">cy:headless</code>) runs all the Cypress tests in a headless browser.
</p>
<p>
In the remainder of this article, I walk you through Cypress test cases and reusable Cypress functions.  All these
examples are used in the end to end tests for my <a href="https://saintsxctf.com">saintsxctf.com</a> website.
</p>
<SectionTitle title="Cypress Test Examples">Cypress Test Examples</SectionTitle>
<p>
Let’s start with some basic examples which test the home page of my <a href="https://saintsxctf.com">saintsxctf.com</a>
website.
</p>
<figure>
<img className="jarombek-blog-image" src="https://asset.jarombek.com/posts/8-7-21-saintsxctf-home-page.png"/>
</figure>
<p>
Cypress test code is built on top of the <a href="https://mochajs.org/">Mocha testing framework</a> and the
<a href="https://www.chaijs.com/">Chai assertion library</a>.  Therefore, engineers familiar with these libraries will
recognize the coding syntax right away.  Cypress test specs often have a similar layout to the following specification
for my website’s home page.
</p>
<CodeSnippet language="JavaScript">
describe('Home E2E Tests', () => {
  beforeEach(() => {
    cy.visit('/');
  });

  it('loads the home page as expected', () => {
    cy.get('.sxctf-home').contains('Cross Country and Track & Field Team Exercise Logs').should('exist');
  });

  ...
});
</CodeSnippet>
<SectionTitle title="Cypress Custom Commands">Cypress Custom Commands</SectionTitle>
<SectionTitle title="Conclusions">Conclusions</SectionTitle>
</div>
